<!DOCTYPE html>
<html>
<head>
	<title>Create property</title>
	<meta charset="utf-8">
</head>
<body>
	<div id="content"></div>
	<script type="text/javascript">
		let capitalize = (input) => {
			return input.charAt(0).toUpperCase()+input.slice(1).toLowerCase();
		};
		let capitalizeFirst = (input) => {
			return input.charAt(0).toUpperCase()+input.slice(1);
		};
		let lowercaseFirst = (input) => {
			return input.charAt(0).toLowerCase()+input.slice(1);
		};
		let convertTableNameToSqlProperty = (name) => {
			return name.toLowerCase();
		};
		let convertNameToSqlProperty = (name) => {
			return name.toUpperCase();
		};
		let convertNameToCSProperty = (name) => {
			return name
				.split("_")
				.map(item => capitalizeFirst(item))
				.join("");
		};
		let convertClassNameToShortName = (classname) => {
			let namespitted = classname.split("_");
			if (namespitted.length < 2) {
				return classname;
			}
			return namespitted.map(item => item.charAt(0).toUpperCase()).join("");
		} ;
		let createCSCodeConvertFromString = (input, type) => {
			if (type === "int") {
				return `Convert.ToInt32(${input})`;
			}
			if (type === "float") {
				return `(float)Convert.ToDouble(${input})`;
			}
			return input;
		};
		let createCSCodeConditionAccept = (input, type) => {
			if (type === "int") {
				return `${input}  >= 0`;
			}
			if (type === "float") {
				return `${input}  >= 0`;
			}
			if (type === "String") {
				return `${input} != null && ${input} != ""`;
			}
			return `${input}  != null`;
		};
		let createCSCodeDefaultValue = (type) => {
			if (type === "int") {
				return `-1`;
			}
			if (type === "float") {
				return `-1`;
			}
			if (type === "String") {
				return `null`;
			}
			return `null`;
		};

		let content = document.querySelector("#content");
		let datas = [
			{
				classname: "Ban", 
				properties: [
					{name: "id_Ban", type: "int", speak:"id bàn"},
					{name: "ten", type: "String", speak:"tên bàn"},
					{name: "trang_Thai", type: "int", speak:"loại bàn"}
				],
				keys: ["id_Ban"]
			},
			{
				classname: "Cthd", 
				properties: [
					{name: "id_Hoa_Don", type: "int", speak:"id hóa đơn"},
					{name: "id_San_Pham", type: "int", speak:"id sản phẩm"},
					{name: "so_Luong", type: "int", speak:"số lượng"},
					{name: "don_Gia", type: "int", speak:"đơn giá"},
					{name: "diem_Tich_Luy", type: "int", speak:"điểm tích lũy"}
				],
				keys: ["id_Hoa_Don", "id_San_Pham"]
			},
			{
				classname: "Ctkm", 
				properties: [
					{name: "id_Khuyen_Mai", type: "int", speak:"id khuyến mãi"},
					{name: "id_San_Pham", type: "int", speak:"id sản phẩm"},
					{name: "so_Luong", type: "int", speak:"số lượng"},
					{name: "don_Gia", type: "int", speak:"đơn giá"},
					{name: "diem_Tich_Luy", type: "int", speak:"điểm tích lũy"}
				],
				keys: ["id_Khuyen_Mai", "id_San_Pham"]
			},
			{
				classname: "Dat_Ban", 
				properties: [
					{name: "username", type: "String", speak:"tên đăng nhập"},
					{name: "id_Ban", type: "int", speak:"id bàn"},
					{name: "thoi_GIan_Lap", type: "String", speak:"thời gian lập"},
					{name: "thoi_GIan_Nhan", type: "String", speak:"thời gian nhận"},
					{name: "ghi_Chu", type: "String", speak:"ghi chú"}
				],
				keys: ["username", "id_Ban", "thoi_GIan_Lap"]
			},
			{
				classname: "Hoa_Don", 
				properties: [
					{name: "id_Hoa_Don", type: "int", speak:"id hóa đơn"},
					{name: "id_Khach_Hang", type: "int", speak:"id khách hàng"},
					{name: "id_Ban", type: "int", speak:"id bàn"},
					{name: "id_Nhan_Vien", type: "int", speak:"id nhân viên"},
					{name: "thoi_GIan", type: "String", speak:"thời gian"},
					{name: "phan_Tram_Tich_Luy", type: "float", speak:"phần trăm tích lũy"},
					{name: "so_Luong_Diem_Doi", type: "int", speak:"số lượng điểm đổi"},
					{name: "ty_Gia_Diem_Doi", type: "float", speak:"tỷ giá quy đổi"}
				],
				keys: ["id_Hoa_Don"]
			},
			{
				classname: "Khach_Hang", 
				properties: [
					{name: "id_Khach_Hang", type: "int", speak:"id khách hàng"},
					{name: "ten", type: "String", speak:"tên"},
					{name: "sdt", type: "String", speak:"số điện thoại"},
					{name: "username", type: "String", speak:"tên đăng nhập"},
					{name: "diem_Tich_Luy", type: "int", speak:"điểm tích lũy"}
				],
				keys: ["id_Khach_Hang"]
			},
			{
				classname: "Khuyen_Mai", 
				properties: [
					{name: "id_Khuyen_Mai", type: "int", speak:"id khuyến mãi"},
					{name: "ten", type: "String", speak:"tên"},
					{name: "thoi_GIan_Dien_Ra", type: "String", speak:"thời gian diễn ra"},
					{name: "thoi_GIan_Ket_Thuc", type: "String", speak:"thời gian kết thúc"}
				],
				keys: ["id_Khuyen_Mai"]
			},
			{
				classname: "Loai_San_Pham", 
				properties: [
					{name: "id_LoaiSP", type: "int", speak:"id loại sản phẩm"},
					{name: "ten", type: "String", speak:"tên"}
				],
				keys: ["id_LoaiSP"]
			},
			{
				classname: "Nhan_Vien", 
				properties: [
					{name: "id_Nhan_Vien", type: "int", speak:"id nhân viên"},
					{name: "ten", type: "String", speak:"tên"},
					{name: "sdt", type: "String", speak:"số điện thoại"},
					{name: "loai", type: "int", speak:"loại"},
					{name: "username", type: "String", speak:"tên đăng nhập"}
				],
				keys: ["id_Nhan_Vien"]
			},
			{
				classname: "San_Pham", 
				properties: [
					{name: "id_San_Pham", type: "int", speak:"id sản phẩm"},
					{name: "id_LoaiSP", type: "int", speak:"id loại sản phẩm"},
					{name: "ten", type: "String", speak:"tên"},
					{name: "gia", type: "int", speak:"giá"},
					{name: "diem_Tich_Luy", type: "int", speak:"điểm tích lũy"},
					{name: "description", type: "String", speak:"ghi chú"}
				],
				keys: ["id_San_Pham", "id_LoaiSP"]
			},
			{
				classname: "Tai_Khoan", 
				properties: [
					{name: "username", type: "String", speak:"tên đăng nhập"},
					{name: "password", type: "String", speak:"mật khẩu"},
					{name: "type", type: "int", speak:"loại"}
				],
				keys: ["username"]
			}
		];

		content.innerHTML = "";
		for (let data of datas) {
			content.innerHTML += data.classname + "<br>";

			let sqlTableName = convertTableNameToSqlProperty(data.classname);
			let csTableName =convertNameToCSProperty(data.classname);

			let shortTableName = convertClassNameToShortName(data.classname);

			let sqlTablePropertiesNames = data.properties.map(item => convertNameToSqlProperty(item.name));
			let csTablePropertiesNames = data.properties.map(item => convertNameToCSProperty(item.name));

			let tableKeysProperties = data.properties.filter(item => data.keys.find(key => key === item.name));

			let csTableKeysProperties = tableKeysProperties.map(item => {
				return {name: convertNameToCSProperty(item.name), type: item.type, speak: item.speak};
			});

			let csTableNotKeysProperties = data.properties.filter(item => data.keys.find(key => key !== item.name)).map(item => {
				return {name: convertNameToCSProperty(item.name), type: item.type, speak: item.speak};
			});

			let deleteMarkedFunction = `
<br>
deleteMarkedFunction
<br>
<textarea id='${csTableName}' style='width: 100%; height: 250px;' readonly='readonly'>

 $(".custom-toggle-button").filter((index, toggleButton) => getToggleStatus(toggleButton)).each((index, element) => deleteTableQL${shortTableName}Row($(element)) );        

</textarea>
			`;

			let deleteAllFunction = `
<br>
deleteAllFunction
<br>
<textarea id='${csTableName}' style='width: 100%; height: 250px;' readonly='readonly'>

$.post("/${csTableName}/DeleteAll", function (data) {
    //Lấy thông tin 
    let inputJson = data;
    inputJson = inputJson.replace(/&quot;/g, \`"\`);
    let outputs = JSON.parse(inputJson);

    //Xóa khỏi bảng
    if (outputs.output >= 0) {
        tableQuanLy${csTableName}.clear().draw();
    }
})
    .done(function () {
    })
    .fail(function () {
        alert("Không thể gửi dữ liệu đến server để xóa dữ liệu từ CSDL");
    })
    .always(function () {
    });

</textarea>
			`;

			let addFunction = `
<br>
addFunction
<br>
<textarea id='${csTableName}' style='width: 100%; height: 250px;' readonly='readonly'>

$.post("/${csTableName}/Add", { ${csTablePropertiesNames.map((item, index) => `${item}: new${csTableName}.${data.properties[index].name.toLowerCase()}`).join(",")} }, function (data) {
//Lấy thông tin tài khoản
let inputJson = data;
inputJson = inputJson.replace(/&quot;/g, \`"\`);
let outputs = JSON.parse(inputJson);

let themModelResult = true;
if (outputs.errors.Length > 0 || outputs.output < 0) {
    themModelResult = false;
}

//Thêm thành công
if (themModelResult) {
    $("#modelThem${csTableName}").find("#them${csTableName}Alerts").append(createAlerts("success", "Thêm thành công"));
    //Thêm mới vào bảng
    $("#modelThem${csTableName}").find(".close").trigger("click");
    tableQuanLy${csTableName}.row.add(createTableQL${shortTableName}ArrayDataRow(new${csTableName})).draw();
}
//Thêm thất bại
else {
    $("#modelThem${csTableName}").find("#them${csTableName}Alerts").append(createAlerts("danger", "Thêm thất bại"));

    for (let error of outputs.errors) {
        $("#modelThem${csTableName}").find("#them${csTableName}Alerts").append(createAlerts("danger", error));
    }
}
})
.done(function () {
})
.fail(function () {                
    alert("Không thể gửi dữ liệu đến server để thêm dữ liệu vào CSDL");
    $("#modelThem${csTableName}").find("#them${csTableName}Alerts").append(createAlerts("danger", "Thêm thất bại"));
})
.always(function () {
});

</textarea>
			`;

			let editFunction = `
<br>
editFunction
<br>
<textarea id='${csTableName}' style='width: 100%; height: 250px;' readonly='readonly'>

$.post("/${csTableName}/Edit", { ${csTablePropertiesNames.map((item, index) => `${item}: new${csTableName}.${data.properties[index].name.toLowerCase()}`).join(",")} }, function (data) {
//Lấy thông tin tài khoản
let inputJson = data;
inputJson = inputJson.replace(/&quot;/g, \`"\`);
${csTablePropertiesNames.map(item => `inputJson = inputJson.replace(/${item}/g, \`${item.toLowerCase()}\`);`).join(";\n")}
let outputs = JSON.parse(inputJson);

let suaModelResult = true;
if (outputs.errors.length > 0 || outputs.output < 0) {
    suaModelResult = false;
}

//Sửa thành công
if (suaModelResult) {
    $("#modelSua${csTableName}").find("#sua${csTableName}Alerts").append(createAlerts("success", "Sửa thành công"));

    //Sửa tài khoản mới vào bảng
    $("#modelSua${csTableName}").find(".close").trigger("click");
    tableQuanLy${csTableName}.row(old${csTableName}Row).data(createTableQL${shortTableName}ArrayDataRow(outputs.new${csTableName})).draw();
}
//Sửa thất bại
else {
    $("#modelSua${csTableName}").find("#sua${csTableName}Alerts").append(createAlerts("danger", "Sửa thất bại"));

    for (let error of outputs.errors) {
        $("#modelSua${csTableName}").find("#sua${csTableName}Alerts").append(createAlerts("danger", error));
    }
}
})
.done(function () {
})
.fail(function () {
    alert("Không thể gửi dữ liệu đến server để sửa dữ liệu vào CSDL");
    $("#modelSua${csTableName}").find("#sua${csTableName}Alerts").append(createAlerts("danger", "Sửa thất bại"));
})
.always(function () {
});   

</textarea>
			`;

			let getAllFunction = `
<br>
getAllFunction
<br>
<textarea id='${csTableName}' style='width: 100%; height: 250px;' readonly='readonly'>

$.post("/${csTableName}/GetAll", function (data) {
//Lấy thông tin tài khoản
let inputJson = data;
inputJson = inputJson.replace(/&quot;/g, \`"\`);
${csTablePropertiesNames.map(item => `inputJson = inputJson.replace(/${item}/g, \`${item.toLowerCase()}\`);`).join(";\n")}
let outputs = JSON.parse(inputJson);

//Thêm vào bảng
for (let output of outputs) {
    tableQuanLy${csTableName}.row.add(createTableQL${shortTableName}ArrayDataRow(output));
}
tableQuanLy${csTableName}.draw();
})
.done(function () {
})
.fail(function () {
    alert("Không thể gửi dữ liệu đến server để lấy dữ liệu từ CSDL");
})
.always(function () {
});

</textarea>
			`;

			let deleteFunction = `
<br>
deleteFunction
<br>
<textarea id='${csTableName}' style='width: 100%; height: 250px;' readonly='readonly'>

let ${lowercaseFirst(csTableName)} = extractDataFromTableQL${shortTableName}Row(tableRow);
$.post("/${csTableName}/Delete", { ${csTableKeysProperties.map((key, index) => `${key.name}: ${lowercaseFirst(csTableName)}.${tableKeysProperties[index].name.toLowerCase()}`).join(",")} }, function (data) {
//Lấy thông tin 
let inputJson = data;
inputJson = inputJson.replace(/&quot;/g, \`"\`);
let outputs = JSON.parse(inputJson);

//Xóa khỏi bảng
if (outputs.output >= 0) {
    tableQuanLy${csTableName}.row(tableRow).remove().draw();
}
})
.done(function () {
})
.fail(function () {
    alert("Không thể gửi dữ liệu đến server để xóa dữ liệu từ CSDL");
})
.always(function () {
});

</textarea>
			`;

			content.innerHTML += deleteMarkedFunction;
			content.innerHTML += "<br>------<br>";
			content.innerHTML += deleteAllFunction;
			content.innerHTML += "<br>------<br>";
			content.innerHTML += addFunction;			
			content.innerHTML += "<br>------<br>";
			content.innerHTML += editFunction;			
			content.innerHTML += "<br>------<br>";
			content.innerHTML += getAllFunction;			
			content.innerHTML += "<br>------<br>";
			content.innerHTML += deleteFunction;				
			content.innerHTML += "<br>-----------------------------------------------------------------<br>";
		}

	</script>
</body>
</html>